<!doctype html>
<html>
<head>
    <title>Run for your life!</title>
    <link href="/static/map.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

</head>
<body>
<hr>
<script src="https://code.jquery.com/jquery.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
{% if "user_id" in session %}
<button type="button" class="btn btn-info btn-sm" id="loggoutbutton" style="display: none">Loggout</button>
{% else %}
<button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#loginModal" id="loginbutton">Login/Register</button>
{% endif %}
    {% block content %} stuff {% endblock %}
<!-- Login Modal -->
<div id="loginModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Login/Register</h4>
      </div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="form-group">
            <label for="nickname">Name</label>
            <input type="text" class="form-control" id="nickname" placeholder="Name">
          </div>
          <div class="form-group">
            <label for="email">Email address</label>
            <input type="email" class="form-control" id="email" placeholder="Email">
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" class="form-control" id="password" placeholder="Password">
          </div>
          <div class="checkbox">
            <label>
              <input type="checkbox">Remember me
            </label>
          </div>
          <button type="submit" class="btn btn-default">Submit</button>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
<!-- message modal -->
<div id="messageModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="messageBody"></h4>
      </div>
    </div>
  </div>
</div>

{% if "user_id" in session %}
<button type="button" class="btn btn-info btn-sm" data-toggle="modal" data-target="#searchModal" id="searchbutton">Search History</button>
<!-- saved searches modal -->
<div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="searchHeader"></h4>
      </div>
      <div class="modal-body" id="searchBody">
            <p>see searches here</p>
      </div>
    </div>
  </div>
</div>
{% endif %}
<script>
function doMessage(result) {
    var message = result["message"];
    $("#messageBody").html(message);
    $('#messageModal').modal("show");
    if (result["success"]) {
        $("#loginbutton").hide();
        $('#loggoutbutton').attr('style', 'display');
    }
}
function loginUser(evt) {
    evt.preventDefault();
    var formInputs = {
        "email": $("#email").val(),
        "password": $("#password").val()
    };
    if ($("#nickname").val()) {
        formInputs["nickname"] = $("nickname").val();
    }
    $.post("/login.json", formInputs, doMessage);
}
$("#loginForm").on("submit", loginUser);
$("#loggoutbutton").on("click", function() {
    $.get("/loggout.json", doMessage);
    $("#loggoutbutton").hide();
    $("#loginbutton").show();
});
</script>
</body>
</html>