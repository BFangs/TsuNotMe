{% extends 'base.html' %}
{% block content %}

<h1>TsuNotMe</h1>
<div>
<h2>WAVE</h2>
</div>
<div>
<h2>START LOCATION</h2>
</div>
<div id="escape-story">
<h2>ESCAPE</h2>
<button type="button" id="LocationPicker">I Picked My Location!</button>
</div>
<div id="floating-panel">
    <input id="address" type="textbox" value="Hackbright">
    <input id="geo-submit" type="button" value="Set Marker!">
</div>
<div id='google_map'></div>
<script src="https://code.jquery.com/jquery.js"></script>
<script>
    var map;
    var San_Francisco = {lat: 37.7749, lng: -122.4194};
    var start_marker;
    var start_lat;
    var start_lng;
    var end_marker;
    var end_lat;
    var end_lng;
    function initMap() {
        map = new google.maps.Map(document.getElementById('google_map'), {
            center: San_Francisco,
            zoom: 12
        });
        start_marker = new google.maps.Marker({
            position: San_Francisco,
            draggable: true,
            map: map,
            title: 'BOOP'
        });
        google.maps.event.addListener(map, 'click', function(event) {
            updateMarker(event.latLng);
        });
        start_marker.addListener('dragend', function(event) {
            updateLocation();
        });
        updateLocation();
        var geocoder = new google.maps.Geocoder();

        document.getElementById('geo-submit').addEventListener('click', function() {
          geocodeAddress(geocoder, map);
        });
    }
    function updateLocation(){
        start_lat = start_marker.getPosition().lat();
        start_lng = start_marker.getPosition().lng();
        console.log(start_lat, start_lng);
    }
    function updateMarker(data){
        start_marker.setPosition(data);
        updateLocation();
    }
    function geocodeAddress(geocoder, map) {
        var address = document.getElementById('address').value;
        geocoder.geocode({'address': address}, function(results, status) {
            if (status === 'OK') {
                map.setCenter(results[0].geometry.location);
                updateMarker(results[0].geometry.location)
            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }
    function showPoints(results) {
        console.dir(results);
        $("#escape-story").html("<p>the user is in tile: "+results["tile_id"]+"</p>");
        $("#escape-story").html("<p>The nearest high point is at lat: "+results["latitude"]+"long: "+results["longitude"]+"elevation: "+results["elevation"]+"</p>");
        $("#escape-story").html("<p>What will happen to you?</p>");
    }
    function getPoints(evt) {
        evt.preventDefault();
        var formInputs = {
            "latitude": start_lat,
            "longitude": start_lng,
        };
        $.get("/start.json", formInputs, showPoints);
    }
    $("#LocationPicker").on("click", getPoints);
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ API_KEY }}&callback=initMap" async defer></script>



{% endblock %}
